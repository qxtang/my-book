<!DOCTYPE html>
<html lang="zh-cn">
  <head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Book - 浏览器缓存</title>

  <!-- styles -->
  <link rel="stylesheet" href="/my-book/resource/lib/github-markdown.min.css" />
  <link rel="stylesheet" href="/my-book/resource/style.css" />
  <link rel="stylesheet" href="/my-book/resource/lib/highlight.default.min.css" />
  <link rel="stylesheet" href="//unpkg.com/viewerjs@1.10.4/dist/viewer.min.css" />

  <!-- scripts -->
  <script src="/my-book/resource/lib/jquery.min.js"></script>

  <link rel="manifest" href="/my-book/manifest.json" />
  <link rel="shortcut icon" type="image/x-icon" href="/my-book/resource/favicon.ico" />
  <link rel="bookmark" type="image/x-icon" href="/my-book/resource/favicon.ico" />
  <link rel="apple-touch-icon" href="/my-book/resource/favicon.ico" />

  <!-- 编译时间：4/8/2022, 9:43:32 AM -->

  <script>
    window.root = '/my-book';

    // 提前把搜索数据库载入内存
    fetch(`${window.root}/dir_tree.json`)
      .then(function (res) {
        return res.json();
      })
      .then(function (res) {
        window.__doc_builder_dirTree__ = res;
      });
  </script>

  <script src="/my-book/resource/script.js"></script>
</head>

  <body>
    <ul class="menu expand" id="menu">
      <div class="search_bar" id="search_bar">
        <input type="text" placeholder="search..." />
        <img
          class="clear"
          id="clear"
          src="https://cdn.jsdelivr.net/gh/FortAwesome/font-awesome/svgs/solid/circle-xmark.svg"
          alt=""
        />
        <div class="search_result" id="search_result"></div>
      </div>
      
            <ul class="parent open">
              <li id="工作沉淀" class="dir" title="工作沉淀">
                <span>工作沉淀</span>
                <div class="triangle"></div>
              </li>
              
          <li id="工作沉淀/Fiddler 真机调试微信 h5.md" class="children" title="Fiddler 真机调试微信 h5">
            <a href="/my-book/工作沉淀/Fiddler 真机调试微信 h5.html">Fiddler 真机调试微信 h5</a>
          </li>
        
          <li id="工作沉淀/GitFlow 学习笔记.md" class="children" title="GitFlow 学习笔记">
            <a href="/my-book/工作沉淀/GitFlow 学习笔记.html">GitFlow 学习笔记</a>
          </li>
        
          <li id="工作沉淀/Nginx 学习笔记.md" class="children" title="Nginx 学习笔记">
            <a href="/my-book/工作沉淀/Nginx 学习笔记.html">Nginx 学习笔记</a>
          </li>
        
          <li id="工作沉淀/工作中遇到问题汇总.md" class="children" title="工作中遇到问题汇总">
            <a href="/my-book/工作沉淀/工作中遇到问题汇总.html">工作中遇到问题汇总</a>
          </li>
        
          <li id="工作沉淀/我的最佳实践.md" class="children" title="我的最佳实践">
            <a href="/my-book/工作沉淀/我的最佳实践.html">我的最佳实践</a>
          </li>
        
          <li id="工作沉淀/敏捷迭代.md" class="children" title="敏捷迭代">
            <a href="/my-book/工作沉淀/敏捷迭代.html">敏捷迭代</a>
          </li>
        
          <li id="工作沉淀/登录方案.md" class="children" title="登录方案">
            <a href="/my-book/工作沉淀/登录方案.html">登录方案</a>
          </li>
        
          <li id="工作沉淀/设计稿多端适配方案.md" class="children" title="设计稿多端适配方案">
            <a href="/my-book/工作沉淀/设计稿多端适配方案.html">设计稿多端适配方案</a>
          </li>
        
            </ul>
          
            <ul class="parent open">
              <li id="前端技术" class="dir" title="前端技术">
                <span>前端技术</span>
                <div class="triangle"></div>
              </li>
              
            <ul class="parent open">
              <li id="前端技术/浏览器" class="dir" title="浏览器">
                <span>浏览器</span>
                <div class="triangle"></div>
              </li>
              
          <li id="前端技术/浏览器/事件循环.md" class="children" title="事件循环">
            <a href="/my-book/前端技术/浏览器/事件循环.html">事件循环</a>
          </li>
        
          <li id="前端技术/浏览器/浏览器.md" class="children" title="浏览器">
            <a href="/my-book/前端技术/浏览器/浏览器.html">浏览器</a>
          </li>
        
          <li id="前端技术/浏览器/浏览器架构.md" class="children" title="浏览器架构">
            <a href="/my-book/前端技术/浏览器/浏览器架构.html">浏览器架构</a>
          </li>
        
          <li id="前端技术/浏览器/浏览器缓存.md" class="children" title="浏览器缓存">
            <a href="/my-book/前端技术/浏览器/浏览器缓存.html">浏览器缓存</a>
          </li>
        
            </ul>
          
          <li id="前端技术/AST抽象语法树.md" class="children" title="AST抽象语法树">
            <a href="/my-book/前端技术/AST抽象语法树.html">AST抽象语法树</a>
          </li>
        
          <li id="前端技术/Babel.md" class="children" title="Babel">
            <a href="/my-book/前端技术/Babel.html">Babel</a>
          </li>
        
          <li id="前端技术/Browserslist.md" class="children" title="Browserslist">
            <a href="/my-book/前端技术/Browserslist.html">Browserslist</a>
          </li>
        
          <li id="前端技术/CSS.md" class="children" title="CSS">
            <a href="/my-book/前端技术/CSS.html">CSS</a>
          </li>
        
          <li id="前端技术/Fiber.md" class="children" title="Fiber">
            <a href="/my-book/前端技术/Fiber.html">Fiber</a>
          </li>
        
          <li id="前端技术/Hooks.md" class="children" title="Hooks">
            <a href="/my-book/前端技术/Hooks.html">Hooks</a>
          </li>
        
          <li id="前端技术/Nodejs.md" class="children" title="Nodejs">
            <a href="/my-book/前端技术/Nodejs.html">Nodejs</a>
          </li>
        
          <li id="前端技术/React.md" class="children" title="React">
            <a href="/my-book/前端技术/React.html">React</a>
          </li>
        
          <li id="前端技术/Typescript.md" class="children" title="Typescript">
            <a href="/my-book/前端技术/Typescript.html">Typescript</a>
          </li>
        
          <li id="前端技术/Vue.md" class="children" title="Vue">
            <a href="/my-book/前端技术/Vue.html">Vue</a>
          </li>
        
          <li id="前端技术/Webpack.md" class="children" title="Webpack">
            <a href="/my-book/前端技术/Webpack.html">Webpack</a>
          </li>
        
          <li id="前端技术/npm.md" class="children" title="npm">
            <a href="/my-book/前端技术/npm.html">npm</a>
          </li>
        
          <li id="前端技术/函数式编程.md" class="children" title="函数式编程">
            <a href="/my-book/前端技术/函数式编程.html">函数式编程</a>
          </li>
        
          <li id="前端技术/原型链和继承.md" class="children" title="原型链和继承">
            <a href="/my-book/前端技术/原型链和继承.html">原型链和继承</a>
          </li>
        
          <li id="前端技术/微信开发.md" class="children" title="微信开发">
            <a href="/my-book/前端技术/微信开发.html">微信开发</a>
          </li>
        
          <li id="前端技术/微前端.md" class="children" title="微前端">
            <a href="/my-book/前端技术/微前端.html">微前端</a>
          </li>
        
          <li id="前端技术/手写题.md" class="children" title="手写题">
            <a href="/my-book/前端技术/手写题.html">手写题</a>
          </li>
        
          <li id="前端技术/模块.md" class="children" title="模块">
            <a href="/my-book/前端技术/模块.html">模块</a>
          </li>
        
          <li id="前端技术/虚拟列表.md" class="children" title="虚拟列表">
            <a href="/my-book/前端技术/虚拟列表.html">虚拟列表</a>
          </li>
        
          <li id="前端技术/设计模式.md" class="children" title="设计模式">
            <a href="/my-book/前端技术/设计模式.html">设计模式</a>
          </li>
        
          <li id="前端技术/语言基础.md" class="children" title="语言基础">
            <a href="/my-book/前端技术/语言基础.html">语言基础</a>
          </li>
        
            </ul>
          
          <li id="其他.md" class="children" title="其他">
            <a href="/my-book/其他.html">其他</a>
          </li>
        
          <li id="网络.md" class="children" title="网络">
            <a href="/my-book/网络.html">网络</a>
          </li>
        
      <li id="index.md" class="children about">
        <a href="/my-book/">关于</a>
      </li>
    </ul>
    <div class="drager" id="drager">
      <div class="switcher" id="switcher" title="展开或收起"></div>
    </div>
    <div class="mobile_menu" id="mobile_menu">
      <img src="https://cdn.jsdelivr.net/gh/FortAwesome/font-awesome/svgs/solid/bars.svg" alt="" />
    </div>
    <div class="content markdown-body">
      <h1 id="%E5%8F%82%E8%80%83" tabindex="-1"><a class="header-anchor" href="#%E5%8F%82%E8%80%83">参考</a></h1>
<ul>
<li><a href="https://www.jianshu.com/p/54cc04190252" target="_blank">https://www.jianshu.com/p/54cc04190252</a></li>
</ul>
<h1 id="%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BC%93%E5%AD%98" tabindex="-1"><a class="header-anchor" href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BC%93%E5%AD%98">浏览器缓存</a></h1>
<ul>
<li>Web 缓存种类： 数据库缓存，CDN 缓存，服务器缓存（例如 redis），浏览器缓存</li>
<li>浏览器实现了 http 缓存</li>
<li>浏览器缓存类型：强缓存，协商缓存</li>
<li>只有 get 请求会缓存，post 请求不会</li>
</ul>
<h1 id="%E7%BC%93%E5%AD%98%E4%BD%8D%E7%BD%AE" tabindex="-1"><a class="header-anchor" href="#%E7%BC%93%E5%AD%98%E4%BD%8D%E7%BD%AE">缓存位置</a></h1>
<h2 id="memory-cache" tabindex="-1"><a class="header-anchor" href="#memory-cache">Memory Cache</a></h2>
<ul>
<li>内存中缓存</li>
<li>主要包含的是当前页面中已经抓取到的资源，已经下载的样式、脚本、图片</li>
<li>读取高效、持续性很短</li>
<li>随着进程的释放而释放，杀进程或者关闭 Tab 页面会被释放</li>
<li>对于大文件来说，大概率是不存储在 Memory Cache 的，反之优先</li>
</ul>
<h2 id="disk-cache" tabindex="-1"><a class="header-anchor" href="#disk-cache">Disk Cache</a></h2>
<ul>
<li>磁盘缓存</li>
<li>浏览器获取当前系统内存使用率，过高的话，优先存储进 Disk Cache</li>
<li>所有类型资源都可以放</li>
<li>速度较慢</li>
<li>不会被释放</li>
<li>容量大</li>
</ul>
<h1 id="%E7%BC%93%E5%AD%98%E8%BF%87%E7%A8%8B" tabindex="-1"><a class="header-anchor" href="#%E7%BC%93%E5%AD%98%E8%BF%87%E7%A8%8B">缓存过程</a></h1>
<p>首次请求：</p>
<p><img src="../../resource/%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BC%93%E5%AD%98%E9%A6%96%E6%AC%A1%E8%AF%B7%E6%B1%82.drawio.png" alt=""></p>
<p>总体大致流程：</p>
<p><img src="../../resource/%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BC%93%E5%AD%98%E8%BF%87%E7%A8%8B.png" alt=""></p>
<p><img src="../../resource/%E7%BC%93%E5%AD%98%E8%BF%87%E7%A8%8B.jpeg" alt=""></p>
<h2 id="%E5%BC%BA%E7%BC%93%E5%AD%98" tabindex="-1"><a class="header-anchor" href="#%E5%BC%BA%E7%BC%93%E5%AD%98">强缓存</a></h2>
<ul>
<li>
<p>当符合命中强缓存的条件，不向服务器发送请求，直接从缓存中读取资源，返回 200 状态码</p>
</li>
<li>
<p>如果响应头有如下字段（按优先级小到大排序）：expires &lt; pragma &lt; cache-control，则为强缓存</p>
</li>
<li>
<p>cache-control 优先级最高，当不支持 http1.1 的环境才会使用 expires 或者 pragma</p>
</li>
<li>
<p>expires</p>
<ul>
<li>资源到期时间、格式为格林尼治时间戳</li>
<li>如果未超过过期时间，直接使用该缓存</li>
<li>缺点：要求客户端和服务端时钟严格同步，本地时间可以自己修改</li>
</ul>
</li>
<li>
<p>pragma</p>
<ul>
<li>HTTP 1.0</li>
<li>用于禁用网页缓存</li>
<li>取值为 no-cache，和 cache-control 的 no-cache 效果一样</li>
</ul>
</li>
<li>
<p>cache-control</p>
<ul>
<li>HTTP 1.1 新增</li>
<li>取值
<ul>
<li>public：资源客户端和服务器都可以缓存</li>
<li>privite：资源只有客户端可以缓存</li>
<li>no-cache：客户端缓存资源，但是是否缓存需要经过协商缓存来验证</li>
<li>no-store：不使用缓存</li>
<li>max-age：缓存保质期</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="%E5%8D%8F%E5%95%86%E7%BC%93%E5%AD%98" tabindex="-1"><a class="header-anchor" href="#%E5%8D%8F%E5%95%86%E7%BC%93%E5%AD%98">协商缓存</a></h2>
<p><img src="../../resource/%E5%8D%8F%E5%95%86%E7%BC%93%E5%AD%98.jpeg" alt=""></p>
<ul>
<li>强缓存失效后，浏览器携带缓存标识向服务器发送请求，由服务器根据缓存标识来决定是否使用缓存的过程</li>
<li>会向服务器发送请求</li>
<li>协商缓存过程
<ul>
<li>服务器发现资源无需更新，返回 304</li>
<li>浏览器从本地缓存中获取资源，继续使用</li>
<li>如果服务器发现该资源更新了，返回该资源，状态码 200</li>
<li>浏览器更新该资源和缓存标识到本地缓存</li>
</ul>
</li>
</ul>
<h3 id="%E7%9B%B8%E5%85%B3-header" tabindex="-1"><a class="header-anchor" href="#%E7%9B%B8%E5%85%B3-header">相关 header</a></h3>
<p>Last-Modified / If-Modified-Since</p>
<ul>
<li>存在的问题：时间单位只精确到秒，如果文件 1 秒内改变多次，无法确保缓存精度；有可能文件内容没变，但是修改时间因为某些原因变了，人为修改之类的</li>
<li>Last-Modified（响应头）
<ul>
<li>资源在服务器最后被修改的时间</li>
</ul>
</li>
<li>If-Modified-Since（请求头）
<ul>
<li>携带上次请求返回的 Last-Modified</li>
<li>告诉服务器该资源上次请求时的最后被修改时间</li>
<li>服务器做对比后决定协商缓存是否生效，返回 304 或 200</li>
</ul>
</li>
</ul>
<p>Etag / If-None-Match</p>
<ul>
<li>优先级高于 Last-Modified，解决 Last-Modified 的问题，但性能比 Last-Modified 差，Etag 需要计算</li>
<li>Etag（响应头）
<ul>
<li>当前资源文件唯一标识，由服务器生成，由文件内容决定</li>
</ul>
</li>
<li>If-None-Match（请求头）
<ul>
<li>携带上次请求该资源时返回的 Etag，告诉服务器</li>
<li>服务器做对比，一致则代表生效，返回 304 或 200</li>
</ul>
</li>
</ul>
<h1 id="%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8" tabindex="-1"><a class="header-anchor" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8">实际应用</a></h1>
<ul>
<li>需要实时更新频繁变动的资源，设置 cache-control 为 no-cache</li>
<li>不常变化的资源，例如 jquery，设置 cache-control 为 max-age=一个很长的时间</li>
<li>单页应用部署时，入口 html 文件使用协商缓存（确保 html 入口是最新的，能够及时更新）</li>
</ul>
<h1 id="%E6%8C%89%E4%B8%8B-f5-%E6%88%96-ctrl%2Bf5-%E6%97%B6%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88" tabindex="-1"><a class="header-anchor" href="#%E6%8C%89%E4%B8%8B-f5-%E6%88%96-ctrl%2Bf5-%E6%97%B6%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88">按下 F5 或 ctrl+F5 时发生了什么</a></h1>
<ul>
<li>ctrl+f5：跳过强缓存和协商缓存，直接从服务器加载资源</li>
<li>f5：跳过强缓存，会检查协商缓存</li>
<li>浏览器地址栏中输入 URL 回车：走正常流程</li>
</ul>

      <div class="btt" id="btt"></div>
    </div>
    
    <div class="table-of-contents"><ul><li title=参考><a href="#%E5%8F%82%E8%80%83" data-anchor="#%E5%8F%82%E8%80%83">参考</a></li><li title=浏览器缓存><a href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BC%93%E5%AD%98" data-anchor="#%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BC%93%E5%AD%98">浏览器缓存</a></li><li title=缓存位置><a href="#%E7%BC%93%E5%AD%98%E4%BD%8D%E7%BD%AE" data-anchor="#%E7%BC%93%E5%AD%98%E4%BD%8D%E7%BD%AE">缓存位置</a><ul><li title=Memory Cache><a href="#memory-cache" data-anchor="#memory-cache">Memory Cache</a></li><li title=Disk Cache><a href="#disk-cache" data-anchor="#disk-cache">Disk Cache</a></li></ul></li><li title=缓存过程><a href="#%E7%BC%93%E5%AD%98%E8%BF%87%E7%A8%8B" data-anchor="#%E7%BC%93%E5%AD%98%E8%BF%87%E7%A8%8B">缓存过程</a><ul><li title=强缓存><a href="#%E5%BC%BA%E7%BC%93%E5%AD%98" data-anchor="#%E5%BC%BA%E7%BC%93%E5%AD%98">强缓存</a></li><li title=协商缓存><a href="#%E5%8D%8F%E5%95%86%E7%BC%93%E5%AD%98" data-anchor="#%E5%8D%8F%E5%95%86%E7%BC%93%E5%AD%98">协商缓存</a><ul><li title=相关 header><a href="#%E7%9B%B8%E5%85%B3-header" data-anchor="#%E7%9B%B8%E5%85%B3-header">相关 header</a></li></ul></li></ul></li><li title=实际应用><a href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8" data-anchor="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8">实际应用</a></li><li title=按下 F5 或 ctrl+F5 时发生了什么><a href="#%E6%8C%89%E4%B8%8B-f5-%E6%88%96-ctrl%2Bf5-%E6%97%B6%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88" data-anchor="#%E6%8C%89%E4%B8%8B-f5-%E6%88%96-ctrl%2Bf5-%E6%97%B6%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88">按下 F5 或 ctrl+F5 时发生了什么</a></li></ul></div>
    

    <!-- bottom scripts -->
    <script src="//cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/jquery.mark.min.js"></script>
    <script src="//unpkg.com/viewerjs@1.10.4/dist/viewer.min.js"></script>
    <script src="//unpkg.com/jquery-viewer@1.0.1/dist/jquery-viewer.min.js"></script>
  </body>
</html>
